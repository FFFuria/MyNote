#轨迹规划 #多项式曲线法 #人工势场法 #贝塞尔曲线法 #B样条曲线法
>路径与速度解耦
>	局部路径规划
>	速度规划
>横向与纵向解耦
>	横向规划
>	纵向规划

*纵向规划一般指速度上的规划，横向指的是与车辆前进的垂直方向的速度变化的规划*
# 多项式曲线法
*路径和速度耦合的结果*
## 算法
### 简介
对车辆进行特定条件下的曲线拟合，包括但不限于**多项式曲线、双圆弧段曲线、正弦函数曲线、贝塞尔曲线、B样条曲线**
### 思想
- 曲线插值法的核心思想就是基于预先构造的曲线类型，根据车辆期望达到的状态（比如要求车辆到达某点的速度和加速度为期望值），将此期望值作为边界条件代入曲线类型进行方程求解，获得曲线的相关系数。
- 曲线所有的相关系数一旦确定，轨迹规划随之完成。
### 步骤
- **第一步：基于边界条件求解曲线系数**
    首先需要预先确定要使用的曲线类型（比如多项式曲线等）。然后明确车辆期望达到的状态，像到达某一位置时的速度、加速度等期望值，这些期望值作为**边界条件**代入到预先选定的曲线方程中，通过解方程的方式求出曲线的相关系数。
- **第二步：完成轨迹规划**
    当曲线的所有相关系数都确定后，这条曲线就被唯一确定了，基于这条曲线的轨迹规划也就完成了，车辆就能按照这条曲线所规划的轨迹行驶。
## 多项式为例
### 特点
#### 分为三、五、七次多项式曲线
**奇数**
边界条件一般包含两个点的车辆状态（如换道轨迹的起点和终点状态）。从方程解的逻辑出发：两个点的车辆状态（每个点包含位置、速度、加速度等多个维度）使得求解曲线系数的方程需要偶数个系数，对应到多项式次数上就是奇数阶（因为多项式次数 = 系数个数 - 1，偶数个系数则次数为奇数）。
![[file-20251118203348636.png|551]]
![[file-20251118203409210.png|551]]

**三 五 七次**

| 多项式次数 | 最多确定的期望状态维度 |           具体状态           |
| :---: | :---------: | :----------------------: |
|  三次   |      2      |          位置 速度           |
|  五次   |      3      |        位置 速度 加速度         |
|  七次   |      4      | 位置 速度 加速度 加加速度（冲击度、jerk） |
*曲线次数越高，计算时间越长，不利于路径的实时性规划*

#### 五次为例
![[file-20251118204051715.png|551]]
在`t1`又可获得另外三组方程
结合获得
![[file-20251118204219872.png|551]]
系数确定后，位置点和速度点等各点是确立的
**五次多项式是关于时间t的五次多项式**
它不是 “纵向位置y关于横向位置x的五次多项式”（即不是y=f(x)这种以位置为自变量的形式），**自变量是时间t**。
*通俗的讲，轨迹本身可能并非五次多项式，而是x和y位置上关于t为五次多项式*
# 人工势场法
*可能出现 “局部极小值陷阱”（即合力为零，被控对象停滞在非目标区域）。在实际应用中，常结合其他算法（如模拟退火、遗传算法）来优化这一缺陷，以确保路径规划的可靠性。*
## 思想
### 基本思想
1. **基本思想**
    模仿物理学电磁场的原理，在障碍物周围构建**斥力势场**（使被控对象远离障碍物），在目标点周围构建**引力势场**（使被控对象朝向目标点运动）。
2. **受力与路径搜索逻辑**
    被控对象在斥力势场和引力势场的复合场中，受到斥力和引力的合力作用，该合力指引其运动，从而搜索出无碰撞的避障路径。
3. **直观类比**
    将障碍物类比为平原上的**高势能山峰**（被控对象会被 “推离”），目标点类比为**低势能低谷**（被控对象会被 “吸引” 前往），形象地体现了势场的作用机制。
![[file-20251118205906466.png|301]]
### 具体流程
#### 引力势场
引力势场主要与汽车和目标点间的距离有关，距离越大，汽车所受的势能值就越大；距离越小，汽车所受的势能值则越小，所以引力势场的函数为： 
$U_{att}(q) = \frac{1}{2}\eta\rho^2\left(q, q_g\right)$
其中$\eta$为正比例增益系数，$\rho(q, q_g)$为一个矢量，表示汽车的位置$q$和目标点位置$q_g$之间的欧几里德距离$|q - q_g|$，矢量方向是从汽车的位置指向目标点位置。 
相应的引力$F_{att}(X)$为引力场的负梯度： 
$$F_{att}(X) = -\nabla U_{att}(X) = \eta\rho\left(q, q_g\right)$$
*欧几里得距离是最常用的**空间距离度量方法**，核心是计算两点在直线上的最短距离*
#### 斥力势场
决定障碍物斥力势场的因素是汽车与障碍物间的距离，当汽车未进入障碍物的影响范围时，其受到的势能值为零；在汽车进入障碍物的影响范围后，两者之间的距离越大，汽车受到的势能值就越小，距离越小，汽车受到的势能值就越大。斥力势场的势场函数为： $$U_{req}(X)=\begin{cases} \frac{1}{2}k(\frac{1}{\rho(q,q_0)} - \frac{1}{\rho_0})^2 & 0 \leq \rho(q,q_0) \leq \rho_0 \\ 0 & \rho(q,q_0) \geq \rho_0 \end{cases}$$ 其中$k$为正比例系数，$\rho(q,q_0)$为一矢量，方向为从障碍物指向汽车，大小为汽车与障碍物间的距离$|q - q_0|$，$\rho_0$为一常数，表示障碍物对汽车产生作用的最大距离。 相应的斥力为斥力场的负梯度 $$F_{req}(X)=\begin{cases} k(\frac{1}{\rho(q,q_0)} - \frac{1}{\rho_0})\frac{1}{\rho^2(q,q_0)}\nabla\rho(q,q_0) & 0 \leq \rho(q,q_0) \leq \rho_0 \\ 0 & \rho(q,q_0) \geq \rho_0 \end{cases}$$
## 缺陷改进
### 目标不可达
障碍物和目标点距离太近，当汽车到达目标点时，根据势场函数，目标点的引力会降为零，但障碍物的斥力却不为零。这就导致汽车虽然到达了目标点，可在斥力场的作用下没办法停下来，最终出现目标不可达的情况。
最后会导致在目标点的来回震荡
### 陷入局部最优
当车辆处于某个位置时，若若干障碍物的合斥力与目标点的引力大小相等、方向相反，合力就会为 0，车辆不再 “受力”，进而无法向前搜索避障路径。
### 改进
1. 改进障碍物斥力函数
	$\begin{cases} F_{reo1} = k(\dfrac{1}{\rho(q, q_0)} - \dfrac{1}{\rho_0})\dfrac{\rho_g^n}{\rho^2(q, q_0)} \\ F_{reo2} = \dfrac{n}{2}k(\dfrac{1}{\rho(q, q_0)} - \dfrac{1}{\rho_0})^2 \rho_g^{n-1} \end{cases}$
	*一部分斥力引入引力*
	调整斥力的计算逻辑，从而打破原势场中合力为零的局部平衡，或在目标点附近调整斥力与引力的关系
	![[file-20251118211851733.png|349]]
	即斥力会产生一个指向目标的吸引力来打破平衡，改进之后每个障碍物都有一个指向目标点的分力
2. 设置边界斥力势场
	$F_{rep,edge} = \begin{cases} \eta_{edge} \cdot v \cdot e^{\left(\frac{-d}{2}-y\right)} \\ \dfrac{1}{3}\eta_{edge} \cdot y^2 \\ -\dfrac{1}{3}\eta_{edge} \cdot y^2 \\ \eta_{edge} \cdot v \cdot e^{\left(y-\frac{d}{2}\right)} \end{cases}$
	当车辆靠近道路边界时，会受到斥力作用，从而被限制在车道内行驶
	同时，公式中引入车辆速度v，体现了速度对斥力大小的影响（速度越快，斥力可能越强，以更有效地约束车辆在车道内的运动）
# 贝塞尔曲线法
## 贝塞尔曲线法
### 思想
给定一组控制点，按顺序连接这些点会形成 “控制多边形”；贝塞尔曲线会 “逼近” 这个控制多边形，且**调整控制点的坐标，就能改变曲线的形状**。
具体操作上，只需给定`n+1`个数据点（比如换道的起点、终点，或路径上的关键节点），贝塞尔曲线就能生成一条与这些点形状相符的平滑轨迹，让车辆沿着这条曲线稳定行驶。

**要点要求：**
**轨迹连续、曲率连续**：保证车辆行驶时不会出现 “急拐”“突变”，行驶平顺；
**容易被车辆跟随、容易生成**：既符合车辆的动力学能力（比如转向、加速的物理限制），又能通过简单的数学计算快速生成路径。
### 推导
![[file-20251118214225894.png]]
贝塞尔曲线的推导核心是 **“线性插值的迭代”**—— 通过对控制点不断进行线性插值（(1−t)A+tB 形式的运算），从低阶到高阶逐步生成曲线点。阶数越高，曲线的自由度（可调整的形状）越大，三次贝塞尔曲线可用于规划换道、避障等复杂且平滑的轨迹。
#### 线性插值
线性插值是一种**在两个已知数据点之间估算中间值**的数学方法，核心是假设两个点之间的变化是 “线性的”（即呈直线关系）。
比如有两个点 A(x1​,y1​) 和 B(x2​,y2​)，要找在 x 介于 x1​ 和 x2​ 之间的某点 x 对应的 y 值，就可以用线性插值：
它的几何意义是**连接两个点的直线上的点**，通俗来说就是 “两点之间画直线，直线上的点就是插值结果”。
在贝塞尔曲线的推导中，线性插值是基础 —— 每一步生成一阶点、二阶点都是通过线性插值来实现的
*通俗讲就是不断二分出一个作为最终路径节点之一的节点*
![[file-20251118220542125.png]]
![[file-20251118220747977.png]]
贝塞尔曲线的两个关键性质：
一是t=0时曲线起点为P0​，t=1时终点为Pn​；
二是其几何特性不随坐标系变换而变化，保证了曲线在不同空间下的一致性。
三是起点和终点处的切线方向分别与特征多边形的第一条边（P0​P1​）、最后一条边（Pn−1​Pn​）相切。以三次贝塞尔曲线为例，从图像中可直观看到，曲线在起点P0​处的切线沿P0​P1​方向，在终点P3​处的切线沿P2​P3​方向。
![[file-20251118220910964.png]]
![[file-20251118221006549.png]]
四是至少需要三阶贝塞尔曲线（四个控制点）才能生成曲率连续的路径。以三次贝塞尔曲线为例，其通过四个控制点（P0、P1、P2、P3）构建，能满足**二阶导数连续的要求，进而实现曲率连续**，让车辆轨迹在行驶过程中无 “曲率突变”，保证行驶的平顺性与稳定性。
## B样条曲线法
*B - 样条基函数的线性组合，给定区间上的所有样条函数构成一个线性空间。*
### 由来
#### 贝塞尔曲线的缺陷
1. 多边形顶点数（n+1个）决定曲线阶次（n次），灵活性不足。
2. 顶点数较大时，曲线次数和导数次数高，导数多次零点即原函数易出现较多峰谷值，曲线弯曲多。
3. 无法进行局部修改，控制点确定后曲线唯一确定，需要另外添加控制点，一处调整会影响整条曲线
#### B 样条曲线的优势
保留贝塞尔曲线优点的同时，弥补了上述所有缺陷，在路径规划（如自动驾驶局部路径规划）中更具实用性，能灵活调整局部路径且保持整体平滑。
阶次和控制点数量解耦，可以用 5 个控制点生成三次 B 样条曲线，阶次不随控制点数量 “强制增长”，设计时能更灵活地平衡复杂度和平滑度。
### 相关推导
![[file-20251119094833600.png]]
*基函数采用递推式有利于编程*
**每个控制点只在自己的 “区间” 里起作用**。比如P0​只通过B0,k​(u)影响曲线的开头部分，P1​只通过B1,k​(u)影响中间某一段…… 这样调整一个控制点，就只会改变曲线的 “局部轨道”，不会影响全局 —— 这就是 B 样条能局部修改的关键。
节点向量\[u0​,u1​,…,un+k​]就像一把 “标尺”，把参数u的范围分成了很多小段。基函数的 “生效区间” 和曲线的 “分段” 都是由这把标尺决定的。比如想让曲线在某段更精细，就把标尺在这一段多刻几个刻度（增加节点）。
![[file-20251119094848302.png]]
- **基函数非零域（k=1 时）**：一阶基函数是 “分段开关”，比如B0,1​(u)只在\[u0​,u1​]区间内值为 1，其他地方为 0；B1,1​(u)只在\[u1​,u2​]区间生效…… 这体现了基函数的 “局部性”—— 每个基函数只在一小段区间里起作用。
- **三角计算格式**：这是基函数递推的直观展示。不同的区间\[ui​,ui+1​]对应不同的基函数组合，比如在\[u0​,u1​)区间，由B0,1​、B0,2​等基函数层层递推；在\[u1​,u2​)区间，由B1,1​、B1,2​等递推…… 这种 “分段递推” 保证了曲线在不同区间的平滑连接。
- **曲线阶次与段数**：k 阶 B 样条曲线是关于参数u的k−1次曲线（比如 3 阶 B 样条是 2 次曲线，形状更平滑）；段数计算公式n+k+2体现了 “控制点数量n+1和阶数k共同决定曲线分段数”，阶数越高、控制点越多，分段越细，曲线越灵活。
- **节点与定义域**：每个基函数Bi,k​(u)涉及k+1个节点，整个曲线从B0,k​(u)到Bn,k​(u)共涉及n+k+1个节点；“open B 样条” 的定义域\[uk​,un+1​]是为了让曲线起点、终点能和控制点更好地衔接，保证轨迹的 “开头结尾” 更可控。
![[file-20251119095600138.png]]
